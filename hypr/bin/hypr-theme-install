#!/bin/bash

set -e

source "$(dirname "$0")/hypr-utils"
check_deps gum git hypr-theme-set

# hypr-theme-install: Install a new theme from a git repo for Hypr
# Usage: hypr-theme-install <git-repo-url>

if [ -z "$1" ]; then
  echo -e "\e[32mSee https://manuals.omamix.org/2/the-hypr-manual/90/extra-themes\n\e[0m"
  REPO_URL=$(gum input --placeholder="Git repo URL for theme" --header="")
else
  REPO_URL="$1"
fi

if [ -z "$REPO_URL" ]; then
  exit 1
fi

THEMES_DIR="${HYPR_CONFIG_DIR:-$HOME/.config/hypr}/themes"
THEME_NAME=$(basename "$REPO_URL" .git | sed -E 's/^hypr-//; s/-theme$//')
THEME_PATH="$THEMES_DIR/$THEME_NAME"

# Remove existing theme if present
if [ -d "$THEME_PATH" ]; then
  rm -rf "$THEME_PATH"
fi

# Clone the repo directly to the themes directory
git clone "$REPO_URL" "$THEME_PATH"

# Apply the new theme with hypr-theme-set
hypr-theme-set $THEME_NAME

echo "Theme '$THEME_NAME' installed and applied"
