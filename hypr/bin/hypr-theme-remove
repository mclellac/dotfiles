#!/bin/bash

set -e

source "$(dirname "$0")/hypr-utils"
check_deps gum hypr-theme-next notify-send

# hypr-theme-remove: Remove a theme from Hypr by name
# Usage: hypr-theme-remove <theme-name>

if [ -z "$1" ]; then
  mapfile -t extra_themes < <(find "${HYPR_CONFIG_DIR:-$HOME/.config/hypr}/themes" -mindepth 1 -maxdepth 1 -type d ! -xtype l -printf '%f\n')

  if [[ ${#extra_themes[@]} -gt 0 ]]; then
    THEME_NAME=$(gum choose --header="Remove extra theme" "${extra_themes[@]}")
  else
    echo "No extra themes installed."
    exit 1
  fi
else
  THEME_NAME="$1"
fi

THEMES_DIR="${HYPR_CONFIG_DIR:-$HOME/.config/hypr}/themes"
CURRENT_DIR="${HYPR_CONFIG_DIR:-$HOME/.config/hypr}/current"
THEME_PATH="$THEMES_DIR/$THEME_NAME"

# Ensure a theme was set
if [ -z "$THEME_NAME" ]; then
  exit 1
fi

# Check if theme exists before attempting removal
if [ ! -d "$THEME_PATH" ]; then
  echo "Error: Theme '$THEME_NAME' not found."
  exit 1
fi

# Move to the next theme if the current theme is the one being removed
if [ "$(readlink -f "$CURRENT_DIR/theme")" = "$(readlink -f "$THEME_PATH")" ]; then
  hypr-theme-next
fi

# Now remove the theme directory for THEME_NAME
rm -rf "$THEME_PATH"

notify-send "Theme '$THEME_NAME' has been removed." -t 2000
